---
title: "SL-HW2 Kaggle"
output:
  html_document:
    highlight: kate
    toc: yes
---

```{r Load libraries}
suppressMessages(require(data.table, quietly = T))

suppressMessages(require(kernlab, quietly = T))

suppressMessages(require(parallel, quietly = T))
suppressMessages(require(doFuture, quietly = T))

suppressMessages(require(tidymodels, quietly = T))
suppressMessages(require(readr, quietly = T))
```

Load csv file

```{r Load csv}
data <- data.table::fread("data/test4final_hw.csv")
```

Parallel

```{r Parallel initialization}
num_cores <- parallel::detectCores() - 1
registerDoFuture()
```

# Modelling
```{r Starting data matrix}
X <- data[,-c("id")]

X[, "genre"] <- X[, "genre"] %>% 
  lapply(as.character) %>% 
  unlist()

testing <- X[, c(1:7011, 7016:7032, 7034:7040)] %>%
  as.data.frame() %>%
  tibble()
```

## Import model
```{r}
model_date <- "20220603_185823"

svm_rbf_fit <- paste("models/svm_rbf_", model_date, ".rds", sep = "") %>%
  readr::read_rds(.)
```

## Export predictions
```{r}
target <- svm_rbf_fit %>% predict(testing)

final_df <- bind_cols(id = data[, "id"], target) %>%
  select(id, target = .pred)

paste("submissions/submission_", model_date, ".csv", sep = "") %>% 
  write_csv(final_df, file = .)
```

